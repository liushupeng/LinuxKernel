# 系统启动

## 1.1 Linux配置加载

Linux 启动过程中，`init` 及其相关配置文件的访问顺序如下

| 步骤 | 关键文件           | 作用                         |
| ---- | ------------------ | ---------------------------- |
| 1    | `GRUB`             | 引导加载内核                 |
| 2    | `initrd/initramfs` | 提供基本驱动和临时根文件系统 |
| 3    | `/sbin/init`       | 启动 `init` 进程             |
| 4    | `/etc/inittab`     | 读取运行级别和初始化脚本     |
| 5    | `/etc/init.d/rcS`  | 运行系统初始化脚本           |
| 6    | `/etc/init.d/rc`   | 启动当前运行级别的服务       |
| 7    | `/sbin/getty`      | 启动终端，等待用户登录       |

- 现代 Linux **（如 CentOS 7+/Ubuntu 16+）** 已使用 `systemd` 代替 `SysVinit`，不再依赖 `/etc/inittab`，而是 `/etc/systemd/system/`。
- 但在嵌入式 Linux（BusyBox）或老旧系统中，`SysVinit` 仍然常见。

## 1.2 start_kernel

`init/main.c:start_kernel()` 是内核初始化的主函数。它启动系统的大部分子系统，并创建第一个用户空间进程。

```c
start_kernel(void)
{
    set_task_stack_end_magic(current);
    smp_setup_processor_id();
    debug_objects_early_init();

    boot_init_stack_canary();

    cgroup_init_early();

    local_irq_disable();

    early_boot_irqs_disabled = true;

    tick_init();

    boot_cpu_init();
    page_address_init();
    pr_notice("Linux version ...\n");

    early_security_init();
    setup_arch(&command_line);

    mm_init_cpumask(&init_mm);
    setup_command_line(command_line);
    setup_nr_cpu_ids();
    setup_per_cpu_areas();
    smp_prepare_boot_cpu();

    build_all_zonelists(NULL);

    page_alloc_init();

    pr_notice("Kernel command line: %s\n", boot_command_line);

    jump_label_init();
    parse_early_param();
    after_dashes = parse_args("Booting kernel", ...);

    sort_main_extable();
    trap_init();
    mm_init();

    ftrace_init();

    init_IRQ();
    tick_init_interrupt();

    rcu_init();
    init_timers();
    hrtimers_init();
    softirq_init();
    timekeeping_init();
    time_init();
    printk_safe_init();

    perf_event_init();
    profile_init();
    call_function_init();
    WARN(!irqs_disabled(), "Interrupts were enabled early\n");

    early_boot_irqs_disabled = false;
    local_irq_enable();

    kmem_cache_init_late();

    console_init();

    if (panic_later)
        panic("Too many boot %s vars at `%s`\n", ...);

    lockdep_init();

    locking_selftest();

    gart_iommu_init();
    pci_iommu_init();
    after_bootmem = 1;

    mem_encrypt_init();

    kmemleak_init();
    setup_per_cpu_pageset();
    numa_policy_init();
    acpi_early_init();

    if (late_time_init)
        late_time_init();

    sched_clock_init();
    calibrate_delay();

    pidmap_init();
    anon_vma_init();
    acpi_subsystem_init();

    thread_stack_cache_init();
    cred_init();
    fork_init();
    proc_caches_init();

    uts_ns_init();
    user_ns_sysctl_init();
    key_init();
    security_init();
    dbg_late_init();
    vfs_caches_init();
    pagecache_init();
    signals_init();
    seq_file_init();
    proc_root_init();
    nsfs_init();
    cpuset_init();
    cgroup_init();
    taskstats_init_early();
    delayacct_init();

    check_bugs();

    rest_init();
}
```




